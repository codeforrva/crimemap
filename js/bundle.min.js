(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";var Alert=require("./mixins/Alert"),Logging=require("./mixins/Logging"),IncidentDataStore=function(){var e=function(e){e.responseJSON?Alert.sendAlert('And lo! The ground shook and a fell voice uttered fearsome words of great import: "'+e.responseJSON.message+'"'):(Alert.sendAlert("Whoops! Looks like we broke the Internet. Sorry about that."),Logging.error(e))},n=function(n){$("#loading").show();return $.getJSON("https://brigades.opendatanetwork.com/resource/ush7-in5v.json?$$app_token=3sg2sPslVNC65HpUxDTSfRR4d&"+$.param(n)).fail(function(n){e(n)}).then(s)},t={INCIDENT_BASIC_INFO:"incident_location,offense_code,offense_code_desc,incident_date_time,disposition_code_desc",INCIDENT_LOCATION:"incident_location,offense_code"},o=function(e){var o=e.startDate||"2015-01-01",i=e.endDate||"2015-01-05",r=e.fields||t.INCIDENT_BASIC_INFO,s=parseInt(e.limit)||1e3,c=$.Deferred();return n({$select:r,$where:"incident_date_time >= '"+o+"T00:00:00' and incident_date_time <= '"+i+"T23:59:59'",$limit:s}).done(function(e){var n=e.filter(function(e){return e.incident_location.latitude&&e.incident_location.longitude}).map(function(e){return e.incident_address=JSON.parse(e.incident_location.human_address).address,e});c.resolve(n)}),c.promise()},i=function(e){var n=$.Deferred();return e.fields=t.INCIDENT_LOCATION,e.limit=5e4,o(e).done(function(e){n.resolve(e.filter(function(e){return!("-77.43364758299998"==e.incident_location.longitude&&"37.54070234900007"==e.incident_location.latitude||"-77.44491629499998"==e.incident_location.longitude&&"37.546095328000035"==e.incident_location.latitude)}))}),n.promise()},r=function(){return n({$select:"offense_code,offense_code_desc",$group:"offense_code,offense_code_desc",$limit:5e4,$order:"offense_code"})},s=function(e){return e.map(function(e){return e.weight=a(parseInt(e.offense_code)),e.color=c(e.weight),e.strokeColor=c(e.weight,!0),e})},c=function(e,n){var t=18*(10-e);return"hsl("+t+", 80%, "+(n?35:50)+"%)"},a=function(e){switch(parseFloat(e)){case 9:case 100:case 11:return 10;case 120:case 13:case 36:return 8;case 200:case 220:case 520:return 6;case 23:case 240:case 290:case 35:case 40:return 4;case 90:return 2;default:return 1}};return{queryIncidents:o,queryHeatmap:i,queryOffenseCodes:r,Fields:t}}();module.exports=IncidentDataStore;



},{"./mixins/Alert":10,"./mixins/Logging":11}],2:[function(require,module,exports){
"use strict";var Alert=require("../mixins/Alert"),ReactCSSTransitionGroup=React.addons.CSSTransitionGroup,AlertBox=React.createClass({displayName:"AlertBox",getInitialState:function(){return Alert.addAlertListener(function(e,t){this.setState({messages:this.state.messages.concat([{key:(new Date).getTime()+Math.random(),text:e,alertClass:t}])})}.bind(this)),{messages:[]}},render:function(){var e=this.state.messages.map(function(e,t){return setTimeout(function(){var e=this.state.messages.splice(t,1);this.setState({messages:e})}.bind(this),1e4),React.createElement(AlertMessage,{key:e.key,alertClass:e.alertClass,text:e.text})}.bind(this));return React.createElement("div",{id:"alert-container"},React.createElement(ReactCSSTransitionGroup,{transitionName:"alert"},e))}}),AlertMessage=React.createClass({displayName:"AlertMessage",propTypes:{alertClass:React.PropTypes.oneOf(["success","info","warning","danger"]).isRequired,text:React.PropTypes.string.isRequired},render:function(){return React.createElement("div",{className:"alert alert-"+this.props.alertClass},React.createElement("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close"},React.createElement("span",{"aria-hidden":"true"},"×")),this.props.text)}});module.exports=AlertBox;



},{"../mixins/Alert":10}],3:[function(require,module,exports){
"use strict";var ControlPanel=require("./ControlPanel"),Map=require("./Map"),AlertBox=require("./AlertBox"),IncidentDataStore=require("../IncidentDataStore"),Logging=require("../mixins/Logging"),App=React.createClass({displayName:"App",mixins:[Logging],getInitialState:function(){return{startDate:"2015-01-01",endDate:"2015-01-05",incidentFetchTime:new Date,viewType:"markers"}},componentWillMount:function(){this.dateRangeUpdate(),IncidentDataStore.queryOffenseCodes().done(function(e){this.setState({offenseCodes:e})}.bind(this))},dateRangeChanged:function(e){this.setState(e)},dateRangeUpdate:function(){$.when(IncidentDataStore.queryIncidents({startDate:this.state.startDate,endDate:this.state.endDate}),IncidentDataStore.queryHeatmap({startDate:this.state.startDate,endDate:this.state.endDate})).done(function(e,t){this.setState({incidents:e,heatmapPoints:t,incidentFetchTime:new Date})}.bind(this))},viewTypeChanged:function(e){this.setState({viewType:e})},render:function(){var e=void 0;return"markers"==this.state.viewType&&this.state.incidents?e=this.state.incidents.length:"heatmap"==this.state.viewType&&this.state.heatmapPoints&&(e=this.state.heatmapPoints.length),React.createElement("div",{id:"container",className:"container-fluid pull-right"},React.createElement(ControlPanel,{startDate:this.state.startDate,endDate:this.state.endDate,viewType:this.state.viewType,pointCount:e,offenseCodes:this.state.offenseCodes,onDateRangeChanged:this.dateRangeChanged,onDateRangeUpdate:this.dateRangeUpdate,onViewTypeChanged:this.viewTypeChanged}),React.createElement(Map,{viewType:this.state.viewType,incidents:this.state.incidents,heatmapPoints:this.state.heatmapPoints,incidentFetchTime:this.state.incidentFetchTime}),React.createElement(AlertBox,null))}});module.exports=App;



},{"../IncidentDataStore":1,"../mixins/Logging":11,"./AlertBox":2,"./ControlPanel":4,"./Map":6}],4:[function(require,module,exports){
"use strict";var ControlSection=require("./ControlSection"),OffenseCodeList=require("./OffenseCodeList"),ControlPanel=React.createClass({displayName:"ControlPanel",propTypes:{startDate:React.PropTypes.string.isRequired,endDate:React.PropTypes.string.isRequired,viewType:React.PropTypes.string.isRequired,pointCount:React.PropTypes.number,offenseCodes:React.PropTypes.array,onDateRangeChanged:React.PropTypes.func,onDateRangeUpdate:React.PropTypes.func,onViewTypeChanged:React.PropTypes.func},dateRangeChanged:function(){this.props.onDateRangeChanged&&this.props.onDateRangeChanged({startDate:this.refs.startDate.getDOMNode().value,endDate:this.refs.endDate.getDOMNode().value})},dateRangeUpdate:function(){this.props.onDateRangeUpdate&&this.props.onDateRangeUpdate()},viewTypeChanged:function(e){this.props.onViewTypeChanged&&this.props.onViewTypeChanged(e)},render:function(){var e=void 0!==this.props.pointCount?this.props.pointCount+" points displayed. ":void 0;return React.createElement("div",{id:"sidebar",className:"col-sm-3 col-sm-push-9 hidden-xs"},React.createElement("h4",null,"Richmond Police Incident Data"),React.createElement("div",{className:"panel-group",id:"accordion",role:"tablist","aria-multiselectable":"true"},React.createElement(ControlSection,{id:"DateRange",title:"Date Range",expanded:!0},React.createElement("p",null,"Display incidents within this date range:"),React.createElement("form",null,React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"startDate"},"Start Date"),React.createElement("input",{id:"startDate",ref:"startDate",type:"date",value:this.props.startDate,className:"form-control",onChange:this.dateRangeChanged})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"endDate"},"End Date"),React.createElement("input",{id:"endDate",ref:"endDate",type:"date",value:this.props.endDate,className:"form-control",onChange:this.dateRangeChanged})),React.createElement("span",{id:"numMarkers"}),React.createElement("button",{type:"button",className:"btn pull-right btn-primary",onClick:this.dateRangeUpdate},"Update"))),React.createElement(ControlSection,{id:"ViewType",title:"View Type"},React.createElement("form",null,React.createElement("div",{className:"form-group"},React.createElement("label",null,React.createElement("input",{id:"showMarkers",type:"radio",name:"viewType",onChange:this.viewTypeChanged.bind(this,"markers"),checked:"markers"==this.props.viewType?"checked":""}),"  Markers"),React.createElement("br",null),"Show police incidents as markers on the map, which you can click for more info."),React.createElement("div",{className:"form-group"},React.createElement("label",null,React.createElement("input",{id:"showHeatmap",type:"radio",name:"viewType",onChange:this.viewTypeChanged.bind(this,"heatmap"),checked:"heatmap"==this.props.viewType?"checked":""}),"  Heatmap"),React.createElement("br",null),"Show a heatmap view of police incidents, highlighting areas of more activity."))),React.createElement(ControlSection,{id:"OffenseCodes",title:"Offense Codes",renderBody:!1},React.createElement(OffenseCodeList,{offenseCodes:this.props.offenseCodes})),React.createElement(ControlSection,{id:"About",title:"About"},React.createElement("p",null,"This app shows police incidents in Richmond. It has events from January of 2004 through January of 2015."),React.createElement("p",null,"Information comes from the Richmond Police Department's public data portal. The location is accurate to the block number, not the exact address."),React.createElement("p",null,"This app was built by ",React.createElement("a",{href:"http://www.codeforrva.org/"},"Code for RVA"),", a brigade of ",React.createElement("a",{href:"http://www.codeforamerica.org/"},"Code for America"),"."),React.createElement("p",null,"Data is hosted by ",React.createElement("a",{href:"http://www.socrata.com/"},"Socrata")," on the ",React.createElement("a",{href:"https://brigades.opendatanetwork.com/TRANSPARENCY/Richmond-Police-Incident-Data/ush7-in5v"},"Open Data Network"),"."))),React.createElement("div",{className:"pull-right"},e))}});module.exports=ControlPanel;



},{"./ControlSection":5,"./OffenseCodeList":8}],5:[function(require,module,exports){
"use strict";var ControlSection=React.createClass({displayName:"ControlSection",propTypes:{id:React.PropTypes.string.isRequired,title:React.PropTypes.string.isRequired,expanded:React.PropTypes.bool,renderBody:React.PropTypes.bool},getDefaultProps:function(){return{renderBody:!0}},render:function(){if(this.props.renderBody)var e=React.createElement("div",{className:"panel-body"},this.props.children);else var e=React.createElement("div",null,this.props.children);return React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading",role:"tab",id:"heading"+this.props.id},React.createElement("h4",{className:"panel-title"},React.createElement("a",{"data-toggle":"collapse","data-parent":"#accordion",href:"#collapse"+this.props.id,"aria-expanded":"true","aria-controls":"collapse"+this.props.id},this.props.title))),React.createElement("div",{id:"collapse"+this.props.id,className:"panel-collapse collapse "+(this.props.expanded?"in":"out"),role:"tabpanel","aria-labelledby":"heading"+this.props.id},e))}});module.exports=ControlSection;



},{}],6:[function(require,module,exports){
"use strict";var MapInfoWindow=require("./MapInfoWindow"),Logging=require("../mixins/Logging"),Map=React.createClass({displayName:"Map",mixins:[Logging],getInitialState:function(){return{markerGenTime:this.props.incidentFetchTime,heatmapGenTime:this.props.incidentFetchTime}},componentDidMount:function(){var e={center:{lat:37.5333,lng:-77.4667},zoom:12};this.setState({map:new google.maps.Map(this.getDOMNode(),e),infoWindow:new google.maps.InfoWindow})},componentWillReceiveProps:function(e){if(this.shouldGenMarkers(e)){this.log("Generating new markers"),this.setMarkerMap(null);var t=e.incidents.map(function(e){var t=new google.maps.Marker({position:new google.maps.LatLng(e.incident_location.latitude,e.incident_location.longitude),title:e.offense_code_desc,zIndex:e.weight,icon:getIcon(e)});return google.maps.event.addListener(t,"click",function(){this.state.infoWindow.close(),this.state.infoWindow.setContent(React.renderToStaticMarkup(React.createElement(MapInfoWindow,{incident:e}))),this.state.infoWindow.open(this.state.map,t)}.bind(this)),t}.bind(this));this.setState({markers:t,markerGenTime:e.incidentFetchTime})}else if(this.shouldGenHeatmap(e)){this.log("Generating new heatmap"),this.setHeatmapMap(null);var i=e.heatmapPoints.map(function(e){return{location:new google.maps.LatLng(e.incident_location.latitude,e.incident_location.longitude),weight:e.weight}}),a=new google.maps.visualization.HeatmapLayer({data:new google.maps.MVCArray(i),radius:30});this.setState({heatmapLayer:a,heatmapGenTime:e.incidentFetchTime})}},shouldComponentUpdate:function(e){return this.shouldGenMarkers(e)||this.shouldGenHeatmap(e)||this.props.viewType!=e.viewType},render:function(){return"markers"==this.props.viewType?(this.setMarkerMap(this.state.map),this.setHeatmapMap(null)):"heatmap"==this.props.viewType&&(this.setMarkerMap(null),this.setHeatmapMap(this.state.map)),React.createElement("div",{id:"map-canvas",className:"col-sm-9 col-sm-pull-3 col-xs-12"})},setMarkerMap:function(e){if(this.state&&this.state.markers)for(var t in this.state.markers)this.state.markers[t].setMap(e)},setHeatmapMap:function(e){this.state&&this.state.heatmapLayer&&this.state.heatmapLayer.setMap(e)},shouldGenMarkers:function(e){return"markers"==e.viewType&&!!e.incidents&&e.incidentFetchTime>this.state.markerGenTime},shouldGenHeatmap:function(e){return"heatmap"==e.viewType&&!!e.heatmapPoints&&e.incidentFetchTime>this.state.heatmapGenTime}}),getIcon=function(e){return{path:google.maps.SymbolPath.CIRCLE,scale:6,fillColor:e.color,fillOpacity:.9,strokeColor:e.strokeColor,strokeOpacity:.6,strokeWeight:1}};module.exports=Map;



},{"../mixins/Logging":11,"./MapInfoWindow":7}],7:[function(require,module,exports){
"use strict";var MapInfoWindow=React.createClass({displayName:"MapInfoWindow",propTypes:{incident:React.PropTypes.object},render:function(){return React.createElement("div",null,React.createElement("h4",null,this.props.incident.offense_code_desc),React.createElement("p",null,moment(this.props.incident.incident_date_time).format("MMMM D, YYYY h:mm a")),React.createElement("p",null,this.props.incident.disposition_code_desc),React.createElement("p",null,this.props.incident.incident_address),React.createElement("p",null,"(",this.props.incident.incident_location.latitude,", ",this.props.incident.incident_location.longitude,")"))}});module.exports=MapInfoWindow;



},{}],8:[function(require,module,exports){
"use strict";var IncidentDataStore=require("../IncidentDataStore"),OffenseCodeList=React.createClass({displayName:"OffenseCodeList",propTypes:{offenseCodes:React.PropTypes.array},render:function(){var e=this.props.offenseCodes&&this.props.offenseCodes.map(function(e){var t={backgroundColor:e.color};return React.createElement("tr",{className:"offense-code-row",key:e.offense_code+e.offense_code_desc},React.createElement("td",null,React.createElement("i",{style:t})),React.createElement("td",null,e.offense_code),React.createElement("td",null,e.offense_code_desc))});return e&&0!=e.length?React.createElement("table",{className:"table table-striped table-hover table-condensed small offense-codes"},React.createElement("tbody",null,e)):null}});module.exports=OffenseCodeList;



},{"../IncidentDataStore":1}],9:[function(require,module,exports){
"use strict";var App=require("./components/App");React.render(React.createElement(App,null),document.body);



},{"./components/App":3}],10:[function(require,module,exports){
"use strict";var Alert=function(){var r=[];return{sendAlert:function(e,t){t=t||"danger";for(var n in r)r[n](e,t)},addAlertListener:function(e){r.push(e)}}}();module.exports=Alert;



},{}],11:[function(require,module,exports){
"use strict";var Logging=function(){var o=!1,n=function(){};return{log:o?console.log.bind(console):n,warn:o?console.warn.bind(console):n,error:o?console.error.bind(console):n}}();module.exports=Logging;



},{}]},{},[9]);
